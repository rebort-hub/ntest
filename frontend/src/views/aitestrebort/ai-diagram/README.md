# AI图表生成功能使用说明

## 功能概述

AI图表生成功能允许用户基于需求文档和知识库内容，智能生成各种类型的图表，包括流程图、时序图、类图、用例图、ER图、架构图、思维导图和甘特图。

## 主要特性

### ✅ 已实现功能

1. **多种图表类型支持**
   - 流程图 (Flowchart)
   - 时序图 (Sequence Diagram)
   - 类图 (Class Diagram)
   - 用例图 (Use Case Diagram)
   - ER图 (Entity Relationship Diagram)
   - 架构图 (Architecture Diagram)
   - 思维导图 (Mind Map)
   - 甘特图 (Gantt Chart)

2. **多种数据源**
   - 手动输入：用户直接描述需求
   - 需求文档：从项目需求文档中获取内容
   - 知识库：从项目知识库中获取相关信息

3. **图表渲染**
   - 使用 Mermaid 库进行图表渲染
   - 支持 SVG 和 PNG 格式导出
   - 实时预览生成的图表

4. **代码查看**
   - 查看生成的 Mermaid 代码
   - 查看生成的 PlantUML 代码（如果有）
   - 复制代码到剪贴板

5. **模板库**
   - 预定义的图表模板
   - 快速应用模板配置

6. **历史记录**
   - 保存生成历史
   - 重新加载历史记录

## 技术实现

### 前端技术栈
- **Vue 3** + **TypeScript**
- **Element Plus** UI组件库
- **Mermaid** 图表渲染库

### 后端API
- **FastAPI** 后端框架
- **AI图表生成接口**: `/api/aitestrebort/advanced/projects/{project_id}/generate-diagram`

### 核心文件结构
```
src/views/aitestrebort/ai-diagram/
├── index.vue                    # 主页面组件
├── README.md                    # 使用说明

src/utils/
├── mermaid-integration.ts       # Mermaid集成工具

src/types/
├── diagram.ts                   # TypeScript类型定义
```

## 使用方法

### 1. 基本使用流程

1. **选择图表类型**：从下拉菜单中选择要生成的图表类型
2. **选择数据源**：选择手动输入、需求文档或知识库
3. **填写描述**：详细描述要生成的图表内容和要求
4. **选择风格**：选择图表的显示风格
5. **生成图表**：点击"生成图表"按钮
6. **查看结果**：在右侧预览区域查看生成的图表

### 2. 数据源配置

#### 手动输入
- 直接在描述框中输入图表需求
- 适合简单的图表生成需求

#### 需求文档
- 从项目的需求文档中选择相关文档
- 系统会基于文档内容生成图表

#### 知识库
- 从项目的知识库中选择相关知识库
- 系统会基于知识库内容生成图表

### 3. 图表导出

- **SVG格式**：矢量图格式，适合打印和缩放
- **PNG格式**：位图格式，适合在文档中使用
- **代码复制**：复制Mermaid代码，可在其他工具中使用

## 故障排除

### 图表无法显示

**问题**：右侧预览区域显示"图表渲染失败"

**可能原因**：
1. Mermaid库加载失败
2. 生成的代码语法错误
3. 网络连接问题

**解决方案**：
1. 检查网络连接，确保能访问CDN
2. 查看浏览器控制台的错误信息
3. 尝试刷新页面重新加载Mermaid库
4. 检查生成的Mermaid代码语法是否正确

### 数据源无数据

**问题**：选择需求文档或知识库时，下拉菜单为空

**可能原因**：
1. 项目中没有创建需求文档或知识库
2. API接口调用失败
3. 权限不足

**解决方案**：
1. 先在需求管理或知识库管理中创建相关内容
2. 检查用户是否有项目访问权限
3. 查看浏览器网络请求是否成功

### 生成失败

**问题**：点击生成图表后显示"生成图表失败"

**可能原因**：
1. 后端API服务异常
2. 描述内容不够清晰
3. 选择的数据源内容为空

**解决方案**：
1. 检查后端服务是否正常运行
2. 提供更详细和清晰的图表描述
3. 确保选择的数据源有相关内容

## 开发说明

### 添加新的图表类型

1. 在 `src/types/diagram.ts` 中添加新的图表类型
2. 在 `src/utils/mermaid-integration.ts` 中添加示例代码
3. 在后端API中添加对应的生成逻辑
4. 更新前端页面的选项列表

### 集成其他图表库

如果需要支持除Mermaid之外的其他图表库：

1. 创建新的集成工具文件
2. 实现统一的渲染接口
3. 在页面中添加图表库选择选项
4. 更新导出功能以支持新格式

### 自定义样式

可以通过修改Mermaid配置来自定义图表样式：

```typescript
// 在 mermaid-integration.ts 中修改配置
const config: MermaidConfig = {
  theme: 'default', // 可选: default, dark, forest, neutral
  // 其他配置...
}
```

## 更新日志

### v1.0.0 (2024-12-31)
- ✅ 实现基本的AI图表生成功能
- ✅ 支持8种图表类型
- ✅ 集成Mermaid图表渲染
- ✅ 支持多种数据源
- ✅ 实现图表导出功能
- ✅ 添加TypeScript类型支持
- ✅ 完善错误处理和用户提示

## 后续计划

- [ ] 集成更多图表库（如D3.js、ECharts）
- [ ] 支持图表编辑和修改
- [ ] 添加图表分享功能
- [ ] 支持批量生成图表
- [ ] 添加图表版本管理
- [ ] 集成AI优化建议